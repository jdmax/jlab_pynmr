

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>app.classes &mdash; JLab PyNMR 0.2 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> JLab PyNMR
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">JLab PyNMR</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>app.classes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for app.classes</h1><div class="highlight"><pre>
<span></span><span class="sd">&#39;&#39;&#39;PyNMR, J.Maxwell 2020</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QIntValidator</span><span class="p">,</span> <span class="n">QDoubleValidator</span><span class="p">,</span> <span class="n">QRegExpValidator</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pytz</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="k">import</span> <span class="n">optimize</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<div class="viewcode-block" id="ConfigItem"><a class="viewcode-back" href="../../source/app.html#app.classes.ConfigItem">[docs]</a><span class="k">class</span> <span class="nc">ConfigItem</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Single configurable item with validator</span>
<span class="sd">            </span>
<span class="sd">    Args:</span>
<span class="sd">        value: Value of item</span>
<span class="sd">        text: Text string describing item for label</span>
<span class="sd">        valid: QValidator object for the value string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">valid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid</span> <span class="o">=</span> <span class="n">valid</span>
        <span class="c1">#self.line_edit = QLineEdit(str(value))</span>
        <span class="c1">#self.line_edit.setValidator(valid)</span>
        <span class="c1">#self.line_edit.setSizePolicy(QSizePolicy.Preferred, QSizePolicy.Preferred)</span>
        <span class="c1">#self.line_edit.setMinimumWidth(60)</span>
        <span class="c1">#self.label = QLabel(text)</span>

<div class="viewcode-block" id="ConfigItem.set_config"><a class="viewcode-back" href="../../source/app.html#app.classes.ConfigItem.set_config">[docs]</a>    <span class="k">def</span> <span class="nf">set_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Change config settings to those in the LineEdit boxes, changing string to correct type based on validator</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            value: Value to change the config item to.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">QIntValidator</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valid</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">QDoubleValidator</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span></div></div>

<div class="viewcode-block" id="Config"><a class="viewcode-back" href="../../source/app.html#app.classes.Config">[docs]</a><span class="k">class</span> <span class="nc">Config</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Contains all relevent settings data for NMR measurement</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        channel: Dict of current channel setting, selected from config file</span>
<span class="sd">        settings: Dict of settings from config file</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        channel: Dict of channel settings; keys are species, cent_freq, mod_freq, power</span>
<span class="sd">        controls: Dict of ConfigItems for controls</span>
<span class="sd">        freq_list: 1D Numpy array of frequency points in sweep as a float, in MHz</span>
<span class="sd">        freq_bytes: List of frequency steps, as bytes of 16 bit binary word for R&amp;S:        https://www.rohde-schwarz.com/webhelp/sma100a_webhelp_1/Content/fb359696521a42fa.htm</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">channel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span> <span class="o">=</span> <span class="p">{}</span>          <span class="c1"># NMR setings requiring control on run tab     </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="s1">&#39;sweeps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConfigItem</span><span class="p">(</span><span class="mi">640</span><span class="p">,</span> <span class="s1">&#39;Sweeps per Event&#39;</span><span class="p">,</span> <span class="n">QIntValidator</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ConfigItem</span><span class="p">(</span><span class="o">-.</span><span class="mi">08</span><span class="p">,</span> <span class="s1">&#39;Calibration Constant&#39;</span><span class="p">,</span> <span class="n">QDoubleValidator</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        
        <span class="c1"># Make list of frequencies and list of bytes to send to R&amp;S</span>
        <span class="c1"># https://www.rohde-schwarz.com/webhelp/sma100a_webhelp_1/Content/fb359696521a42fa.htm</span>
        <span class="c1"># go from 32767 to -32767, convert to bytes        </span>
        <span class="c1"># even distribution of steps in range</span>
        <span class="n">freq_ints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="mi">32767</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int32&#39;</span><span class="p">)</span>            <span class="c1"># numpy array </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;cent_freq&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">[</span><span class="s1">&#39;mod_freq&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="o">*</span><span class="p">(</span><span class="n">freq_ints</span><span class="p">)</span><span class="o">/</span><span class="mi">32768</span>    <span class="c1"># in MHz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_bytes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;big&#39;</span><span class="p">,</span> <span class="n">signed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">freq_ints</span><span class="p">]</span>   <span class="c1"># bytes for 16-bit word</span></div>
           
<div class="viewcode-block" id="Scan"><a class="viewcode-back" href="../../source/app.html#app.classes.Scan">[docs]</a><span class="k">class</span> <span class="nc">Scan</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Data object for averaged set of sweeps, with method to average.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        config: Config object containing all settings for the scan</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        phase: 1D Numpy array of measurements at each frequency points for the phase</span>
<span class="sd">        diode: 1D Numpy array of measurements at each frequency points for the diode</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># number of sweeps currently in scan</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">freq_list</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">freq_list</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_list</span><span class="p">))</span>       <span class="c1"># list of phase curve points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_list</span><span class="p">))</span>       <span class="c1"># list of diode curve points</span>
           
<div class="viewcode-block" id="Scan.avg_chunks"><a class="viewcode-back" href="../../source/app.html#app.classes.Scan.avg_chunks">[docs]</a>    <span class="k">def</span> <span class="nf">avg_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_sigs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Average new chunk with rest of set.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            new_sigs: tuple of number of sweeps in the chunk, new phase data list and new diode data list</span>
<span class="sd">                </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">num_in_chunk</span><span class="p">,</span> <span class="n">phase_chunk</span><span class="p">,</span> <span class="n">diode_chunk</span> <span class="o">=</span> <span class="n">new_sigs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">+=</span> <span class="n">num_in_chunk</span>
           
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">+</span> <span class="p">(</span><span class="n">num_in_chunk</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">phase_chunk</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diode</span> <span class="o">+</span> <span class="p">(</span><span class="n">num_in_chunk</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">diode_chunk</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">diode</span><span class="p">)</span></div></div>
        
            <span class="c1"># https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance    # get running stats for chunks</span>
            <span class="c1"># rec_sweeps += num_in_chunk</span>
            <span class="c1"># phase_old = phase_set</span>
            <span class="c1"># phase_set = [i + (num_in_chunk/rec_sweeps)*(j - i) for i,j in zip(phase_old, phase_chunk)]</span>
            <span class="c1"># phase_S = [i + num_in_chunk*(j - k)*(j - l) for i,j,k,l in zip(phase_S, phase_chunk, phase_old, phase_set)]</span>
            <span class="c1"># diode_old = diode_set</span>
            <span class="c1"># diode_set = [i + (num_in_chunk/rec_sweeps)*(j - i) for i,j in zip(diode_old, diode_chunk)]</span>
            <span class="c1"># diode_S = [i + num_in_chunk*(j - k)*(j - l) for i,j,k,l in zip(diode_S, diode_chunk, diode_old, diode_set)]</span>
            <span class="c1"># phase_std = [math.sqrt(i/rec_sweeps) for i in phase_S]</span>
            <span class="c1"># diode_std = [math.sqrt(i/rec_sweeps) for i in diode_S]</span>
        
        
<div class="viewcode-block" id="RunningScan"><a class="viewcode-back" href="../../source/app.html#app.classes.RunningScan">[docs]</a><span class="k">class</span> <span class="nc">RunningScan</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Data object for averaged set of sweeps, with method to perform running average.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        config: Config object for scan</span>
<span class="sd">        to_avg: Number of sweeps to keep in running average</span>
<span class="sd">        </span>
<span class="sd">    Attributes:</span>
<span class="sd">        freq_list: Frequency points of sweep in MHz, from config</span>
<span class="sd">        phase: List of measurements at each frequency points for the phase</span>
<span class="sd">        diode: List of measurements at each frequency points for the diode</span>
<span class="sd">        points_in: Number of sweeps currently in the average</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">to_avg</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">freq_list</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">freq_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_list</span><span class="p">))</span>       <span class="c1"># list of phase curve points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diode</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">freq_list</span><span class="p">))</span>       <span class="c1"># list of diode curve points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> <span class="o">=</span> <span class="mi">0</span>              <span class="c1"># sweeps currently in average</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_avg</span> <span class="o">=</span> <span class="n">to_avg</span>

<div class="viewcode-block" id="RunningScan.running_avg"><a class="viewcode-back" href="../../source/app.html#app.classes.RunningScan.running_avg">[docs]</a>    <span class="k">def</span> <span class="nf">running_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_sigs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Performs running average for tuning</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            new_sigs: tuple of number of sweeps in the chunk, new phase data list and new diode data list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">num_in_chunk</span><span class="p">,</span> <span class="n">new_phase</span><span class="p">,</span> <span class="n">new_diode</span> <span class="o">=</span> <span class="n">new_sigs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_avg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> <span class="o">+=</span> <span class="n">num_in_chunk</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_avg</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_phase</span><span class="o">*</span><span class="n">num_in_chunk</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">phase</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> <span class="o">-</span> <span class="n">num_in_chunk</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">diode</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_diode</span><span class="o">*</span><span class="n">num_in_chunk</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">diode</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> <span class="o">-</span> <span class="n">num_in_chunk</span><span class="p">))</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">points_in</span> </div></div>
        
        
        <span class="c1"># self.phase = [(i*num_in_chunk + j*(self.points_in - num_in_chunk))/self.points_in for i, j in zip(new_phase, self.phase)]</span>
        <span class="c1"># self.diode = [(i*num_in_chunk + j*(self.points_in - num_in_chunk))/self.points_in for i, j in zip(new_diode, self.diode)]</span>
            

<div class="viewcode-block" id="Event"><a class="viewcode-back" href="../../source/app.html#app.classes.Event">[docs]</a><span class="k">class</span> <span class="nc">Event</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Data and method object for single event point. Takes config instance on init.</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        config: Config class instance</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        config: Config object for the event</span>
<span class="sd">        scan: Scan object for the event</span>
<span class="sd">        start_time: Datetime object for time event started accumulating measurements</span>
<span class="sd">        start_stamp: Timestamp int for starting datetime</span>
<span class="sd">        stop_time: Datetime object for time event stopped accumulating measurements</span>
<span class="sd">        stop_stamp: Timestamp int for stop datetime</span>
<span class="sd">        basesweep: Baseline phase sweep list</span>
<span class="sd">        basesub: Baseline subtracted phase sweep list for event</span>
<span class="sd">        polysub: Polyfit subtracted basesub list</span>
<span class="sd">        wings: Portion of sweep to use for fit, 4 long list giving position of left start, left stop, right start and right stop positions as a decimal from 0 to 1</span>
<span class="sd">        cc: Calibration constant float</span>
<span class="sd">        area: Area under polyfit curve float</span>
<span class="sd">        pol: Measured polarization for event, CC*Area, float</span>
<span class="sd">        base_time: Datetime object for stop of baseline event</span>
<span class="sd">        base_stamp: Timestamp int of baseline event</span>
<span class="sd">        base_file: Filename string where baseline event can be found</span>
<span class="sd">    &#39;&#39;&#39;</span>
   
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span> <span class="o">=</span> <span class="n">Scan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="c1">#self.start_stamp = (datetime.datetime.utcnow() - datetime.datetime(1970,1,1,0,0,0)).total_seconds()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">basesweep</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basesub</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polysub</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wings</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="o">.</span><span class="mi">75</span><span class="p">,</span><span class="mf">0.99</span><span class="p">]</span>  <span class="c1"># portion of sweep to use for fit</span>
        

        <span class="bp">self</span><span class="o">.</span><span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">controls</span><span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_stamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">base_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_stamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_file</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
        
        
<div class="viewcode-block" id="Event.update_event"><a class="viewcode-back" href="../../source/app.html#app.classes.Event.update_event">[docs]</a>    <span class="k">def</span> <span class="nf">update_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">new_sigs</span><span class="p">):</span>  <span class="c1"># new_sigs looks like ((p_tup1,d_tup1), (p_tup2,d_tup2)...)</span>
        <span class="sd">&#39;&#39;&#39;Method to update event with new signal chunk</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            new_sigs: tuple of number of sweeps in the chunk, new phase data list and new diode data list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">avg_chunks</span><span class="p">(</span><span class="n">new_sigs</span><span class="p">)</span></div>


<div class="viewcode-block" id="Event.print_event"><a class="viewcode-back" href="../../source/app.html#app.classes.Event.print_event">[docs]</a>    <span class="k">def</span> <span class="nf">print_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">eventfile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Print out event to eventfile, formatting to dict to write to json line.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            eventfile: File object to write event to</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="n">exclude_list</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;freq_bytes&#39;</span> <span class="p">]</span>
        <span class="n">json_dict</span> <span class="o">=</span> <span class="p">{}</span>        
        <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>               <span class="c1"># filter event attributes for json dict</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span><span class="n">entry</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()})</span>  <span class="c1"># datetime to string</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">Baseline</span><span class="p">):</span>
                <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span><span class="n">entry</span><span class="o">.</span><span class="n">stop_time</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()})</span>   <span class="c1"># baseline to stoptime string</span>
            <span class="k">elif</span> <span class="s1">&#39;config&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span> 
                <span class="k">for</span> <span class="n">key2</span><span class="p">,</span> <span class="n">entry2</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key2</span> <span class="ow">in</span> <span class="n">exclude_list</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">elif</span> <span class="s1">&#39;controls&#39;</span> <span class="ow">in</span> <span class="n">key2</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">key3</span><span class="p">,</span> <span class="n">entry3</span> <span class="ow">in</span> <span class="n">entry2</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key3</span><span class="p">:</span><span class="n">entry3</span><span class="o">.</span><span class="n">value</span><span class="p">})</span> 
                    <span class="k">else</span><span class="p">:</span> 
                        <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key2</span><span class="p">:</span><span class="n">entry2</span><span class="p">})</span>    
            <span class="k">elif</span> <span class="s1">&#39;scan&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span> 
                <span class="k">for</span> <span class="n">key2</span><span class="p">,</span> <span class="n">entry2</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key2</span><span class="p">:</span><span class="n">entry2</span><span class="p">})</span>
            <span class="k">elif</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span> 
                <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span><span class="n">entry</span><span class="o">.</span><span class="n">chan</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">exclude_list</span><span class="p">:</span> <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">json_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">key</span><span class="p">:</span><span class="n">entry</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">json_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>       
                <span class="n">json_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>    
        <span class="n">json_record</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_dict</span><span class="p">)</span>
        <span class="n">eventfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json_record</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>               <span class="c1"># write to file as json line</span></div>
    
<div class="viewcode-block" id="Event.close_event"><a class="viewcode-back" href="../../source/app.html#app.classes.Event.close_event">[docs]</a>    <span class="k">def</span> <span class="nf">close_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epics_reads</span><span class="p">,</span> <span class="n">eventfile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Closes event, calls fits and plots, writes to disk, history and EPICS</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            eventfile: File object to write event to</span>
<span class="sd">        </span>
<span class="sd">        Todo:</span>
<span class="sd">            * Send data to EPICS, history</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#self.stop_time = datetime.datetime.now()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span> <span class="o">=</span>  <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;US/Eastern&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_stamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_time</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="c1">#self.stop_stamp =  str((datetime.datetime.now(tz=pytz.timezone(&#39;US/Eastern&#39;)) - datetime.datetime(1970,1,1,0,0,0)).total_seconds())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basesub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan</span><span class="o">.</span><span class="n">phase</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">basesweep</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_wings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wings</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">basesub</span><span class="p">)</span>          <span class="c1"># perform fit to wings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poly_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromiter</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fit_params</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">basesub</span><span class="p">))),</span> <span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span>   <span class="c1"># points of curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polysub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basesub</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly_curve</span>        <span class="c1"># fit subtracted</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">polysub</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">+=</span><span class="n">x</span>             <span class="c1"># sum area under fit subtracted curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polysub</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">area</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics_reads</span> <span class="o">=</span> <span class="n">epics_reads</span>       
        <span class="bp">self</span><span class="o">.</span><span class="n">print_event</span><span class="p">(</span><span class="n">eventfile</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="Event.poly"><a class="viewcode-back" href="../../source/app.html#app.classes.Event.poly">[docs]</a>    <span class="k">def</span> <span class="nf">poly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Third order polynomial for fitting</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            p: List of polynomial coefficients</span>
<span class="sd">            x: Sample point</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="c1">#+ p[4]*np.power(x,4)</span></div>
        
<div class="viewcode-block" id="Event.fit_wings"><a class="viewcode-back" href="../../source/app.html#app.classes.Event.fit_wings">[docs]</a>    <span class="k">def</span> <span class="nf">fit_wings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wings</span><span class="p">,</span><span class="n">sweep</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Fit to wings with scipy</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            wings: Wings, 4 element list of portions of sweep to use, attribute from Config</span>
<span class="sd">            sweep: List of samples to fit</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            pf: Tuple of final fit coefficient list</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">wings</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sweep</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&lt;</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="n">x</span><span class="o">&lt;</span><span class="n">bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">data</span><span class="p">])</span>
        
        <span class="n">errfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">poly</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span><span class="mf">0.00001</span><span class="p">]</span>  <span class="c1"># initial guess</span>
        <span class="n">pf</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errfunc</span><span class="p">,</span> <span class="n">pi</span><span class="p">[:],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">))</span>  <span class="c1"># perform fit</span>
        <span class="k">return</span> <span class="n">pf</span></div></div>
        
<div class="viewcode-block" id="Baseline"><a class="viewcode-back" href="../../source/app.html#app.classes.Baseline">[docs]</a><span class="k">class</span> <span class="nc">Baseline</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Data object for baseline event.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        dict: Dict of all event attributes to add as attributes to this object.</span>
<span class="sd">        &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_stamp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_file</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s1">&#39;steps&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>	<span class="c1"># update with attributes from passed event</span></div>
        
  
 
<div class="viewcode-block" id="Status"><a class="viewcode-back" href="../../source/app.html#app.classes.Status">[docs]</a><span class="k">class</span> <span class="nc">Status</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Data object for external EPICS status variables, handles calls to get new values</span>
<span class="sd">    </span>
<span class="sd">    Arguments:</span>
<span class="sd">        chan_names: Dict of epics channels: names strings</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        chan_names: Dict of epics channels: names strings</span>
<span class="sd">        chan: Dict of channels: values</span>

<span class="sd">    Todo:</span>
<span class="sd">        Calls to EPICS to get values</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chan_names</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan_names</span> <span class="o">=</span> <span class="n">chan_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chan</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chan_names</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="mi">0</span><span class="p">)</span></div>

   
<div class="viewcode-block" id="HistPoint"><a class="viewcode-back" href="../../source/app.html#app.classes.HistPoint">[docs]</a><span class="k">class</span> <span class="nc">HistPoint</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Single history point. History contains only critical info from event.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        dt: Datetime object of time event stopped</span>
<span class="sd">        pol: Float measured polarization</span>
<span class="sd">        cc: Float calibration constant</span>
<span class="sd">        area: Float area under polyfit</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">stop_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dt_stamp</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">stop_stamp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pol</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cc</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">cc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">area</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epics_reads</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">epics_reads</span></div>
        
        
<div class="viewcode-block" id="History"><a class="viewcode-back" href="../../source/app.html#app.classes.History">[docs]</a><span class="k">class</span> <span class="nc">History</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Contains polarization history since start, methods for returning subset of points&#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>              <span class="c1"># dict of HistPoints keyed on dt</span>
<div class="viewcode-block" id="History.add_hist"><a class="viewcode-back" href="../../source/app.html#app.classes.History.add_hist">[docs]</a>    <span class="k">def</span> <span class="nf">add_hist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">hp</span><span class="o">.</span><span class="n">dt_stamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">hp</span></div>
<div class="viewcode-block" id="History.to_plot"><a class="viewcode-back" href="../../source/app.html#app.classes.History.to_plot">[docs]</a>    <span class="k">def</span> <span class="nf">to_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_stamp</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stop_stamp</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Gets datetimes and polarizations in history</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            Dict keyed on timestamps of HistPoints          </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">start_stamp</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hist_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">start_stamp</span><span class="o">&lt;</span><span class="n">k</span><span class="o">&lt;</span><span class="n">stop_stamp</span><span class="p">}</span>
            <span class="k">return</span> <span class="n">hist_data</span></div></div>
      
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, James Maxwell

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>